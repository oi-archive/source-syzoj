{"title":"维护序列","time_limit":1000,"memory_limit":512,"tags":["线段树"],"operation":{"submit":"https://syzoj.com/problem/821#submit_code","submissions":"https://syzoj.com/submissions?problem_id=821","statistics":"https://syzoj.com/problem/821/statistics/fastest","testdata":"https://syzoj.com/problem/821/testdata","discussion":"https://syzoj.com/discussion/problem/821"},"statement":[{"title":"题目描述","type":"description","format":"markdown","require":["katex"],"content":"**原题来自：AHOI 2009**\r\n\r\n老师交给小可可一个维护数列的任务，现在小可可希望你来帮他完成。\r\n\r\n有长为 $n$ 的数列，不妨设为 $a_1,a_2,\\cdots ,a_n$。有如下三种操作形式：\r\n+ 把数列中的一段数全部乘一个值；\r\n+ 把数列中的一段数全部加一个值；\r\n+ 询问数列中的一段数的和，由于答案可能很大，你只需输出这个数模 $P$ 的值。"},{"title":"输入格式","type":"input_format","format":"markdown","require":["katex"],"content":"第一行两个整数 $n$ 和 $P$；\r\n\r\n第二行含有 $n$ 个非负整数，从左到右依次为 $a_1,a_2,\\cdots ,a_n$；\r\n\r\n第三行有一个整数 $M$，表示操作总数；\r\n\r\n从第四行开始每行描述一个操作，输入的操作有以下三种形式：\r\n+ 操作 $1$：`1 t g c`，表示把所有满足 $t\\le i\\le g$ 的 $a_i$ 改为 $a_i\\times c$；\r\n+ 操作 $2$：`2 t g c`，表示把所有满足 $t\\le i\\le g$ 的 $a_i$ 改为 $a_i+c$； \r\n+ 操作 $3$：`3 t g`，询问所有满足 $t\\le i\\le g$ 的 $a_i$ 的和模 $P$ 的值。\r\n\r\n同一行相邻两数之间用一个空格隔开，每行开头和末尾没有多余空格。"},{"title":"输出格式","type":"output_format","format":"markdown","require":["katex"],"content":"对每个操作 $3$，按照它在输入中出现的顺序，依次输出一行一个整数表示询问结果。"},{"title":"样例","type":"example","format":"markdown","require":["katex"],"content":"#### 样例输入\r\n```plain\r\n7 43\r\n1 2 3 4 5 6 7\r\n5\r\n1 2 5 5\r\n3 2 4\r\n2 3 7 9\r\n3 1 3\r\n3 4 7\r\n```\r\n\r\n#### 样例输出\r\n```plain\r\n2\r\n35\r\n8\r\n```\r\n\r\n#### 样例说明\r\n初始时数列为 $\\{1,2,3,4,5,6,7\\}$；\r\n\r\n经过第 $1$ 次操作后，数列为 $\\{1,10,15,20,25,6,7\\}$；\r\n\r\n对第 $2$ 次操作，和为 $10+15+20=45$，模 $43$ 的结果是 $2$；\r\n\r\n经过第 $3$ 次操作后，数列为 $\\{1,10,24,29,34,15,16\\}$；\r\n\r\n对第 $4$ 次操作，和为 $1+10+24=35$，模 $43$ 的结果是 $35$；\r\n\r\n对第 $5$ 次操作，和为 $29+34+15+16=94$，模 $43$ 的结果是 $8$。"},{"title":"数据范围与提示","type":"limit_and_hint","format":"markdown","require":["katex"],"content":"对于全部测试数据，$1\\le t\\le g\\le n,0\\le c,a_i\\le 10^9,1\\le P\\le 10^9$。\r\n\r\n测试数据规模如下表所示：\r\n\r\n| 数据编号 | $1$  | $2,3$  |  $4$   |      $5$       |      $6$       |      $7$       |      $8$       | $9,10$ |\r\n| :------: | :--: | :----: | :----: | :------------: | :------------: | :------------: | :------------: | :----: |\r\n|   $n=$   | $10$ | $10^3$ | $10^4$ | $6\\times 10^4$ | $7\\times 10^4$ | $8\\times 10^4$ | $9\\times 10^4$ | $10^5$ |\r\n|   $M=$   | $10$ | $10^3$ | $10^4$ | $6\\times 10^4$ | $7\\times 10^4$ | $8\\times 10^4$ | $9\\times 10^4$ | $10^5$ |\r\n\r\n"}]}