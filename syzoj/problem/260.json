{"title":"[東方] 蓬莱山·辉夜 壹","time_limit":1000,"memory_limit":128,"tags":[],"operation":{"submit":"https://syzoj.com/problem/260#submit_code","submissions":"https://syzoj.com/submissions?problem_id=260","statistics":"https://syzoj.com/problem/260/statistics/fastest","testdata":"https://syzoj.com/problem/260/testdata","discussion":"https://syzoj.com/discussion/problem/260"},"statement":[{"title":"题目描述","type":"description","format":"markdown","require":["katex"],"content":"![Markdown](http://cogs.sxysxy.org/upload/image/20161206/20161206133531_20733.jpg)\r\n\r\n永恒与须臾的置换！\r\n\r\n「那就让满月从此消失于地上好了。\r\n\r\n如此一来，当能中断连接月球与地上之间的通道。\r\n\r\n其实从地上看到的满月，正是唯一能打开那通道的钥匙。\r\n\r\n所以，月之使者亦只有于满月才能到访。\r\n\r\n要是破坏那钥匙的话……\r\n\r\n地上，就成为一个巨大的密室了。」\r\n\r\n完美的计划。\r\n\r\n真正的满月消失了，地上的人类和妖怪们还是发现了一些蛛丝马迹，便要打破辉夜的幻术。\r\n\r\n辉夜的幻术是永恒与须臾之力同时作用的结果。须臾是很短的时间，永恒则是很长的时间。在一个须臾内，幻术阵法可以完成一个变换，T个须臾之后，则会由量变达成质变，须臾化作永恒，幻术阵法便会不攻自破。\r\n\r\n但是地上的人们和妖怪们发现，等到幻术阵法自破需要的时间太长了，有一种快速的破阵方法，那就是直接计算出阵法在T个须臾之后的格局。\r\n\r\n阵法可以看作是由N个小魔法阵，从阵法基石开始，围成一圈构成，按逆时针**位置**编号为0, 1, 2...N-1(每个小魔法阵的编号取决于它所在的位置)。整个阵法建立之初，每个小魔法阵里面只有 1 点能量。每个须臾，这些魔法阵可以进行这样的变换的其中之一：\r\n\r\nclear a 0 表示将第a个魔法阵的能量清零\r\n\r\nderive a b 表示将第b个魔法阵里面的能量都转移到魔法阵a里面(注意b的能量转移到a里面这样b里面就没有能量了)\r\n\r\nswap a b  表示将第a个魔法阵与第b个魔法阵交换位置\r\n\r\nmultiply a b 表示将第a个魔法阵的能量变为原来的b倍\r\n\r\nrotate 0 0表示每个魔法阵都转移到它逆时针方向上下一个魔法阵的位置\r\n\r\nT个须臾里面，整个幻术法阵循环往复地执行着M条变换规则。而且由于小魔法阵储存能量的能力有限，所以小魔法阵里面一旦有超过P点的能量值的话，每P点能量都会被压缩成一团而被排斥消失。\r\n\r\n\r\n众人与众妖怪通过仔细观察记录，发现了幻术法阵变换的规律，也就是法阵重复执行的M条变换规则，并且计算出了小魔法阵的能量阈值P，而且通过查阅上古传说，知道了永恒的时间T。现在这些资料都将交给你，请你帮忙计算出T个须臾后法阵中，每个小魔法阵的能量值。\r\n\r\n\r\n"},{"title":"输入格式","type":"input_format","format":"markdown","require":["katex"],"content":"第一行四个整数T, N, M, P。含义请仔细阅读题面\r\n\r\n接下来M行，每行一条变换规则，格式为一个单词+2个参数，即一个字符串与两个参数。变换规则具体请仔细阅读题面。\r\n"},{"title":"输出格式","type":"output_format","format":"markdown","require":["katex"],"content":"一行N个整数，依次为，从阵法基石(请仔细阅读题面)开始按逆时针位置，编号为0, 1, 2..N-1的小魔法阵中的魔法值。"},{"title":"样例","type":"example","format":"markdown","require":["katex"],"content":"#input1\r\n```\r\n5 4 3 233\r\nrotate 0 0\r\nderive 1 3\r\nmultiply 0 2\r\n```\r\n\r\n#output1\r\n```\r\n0 3 2 0\r\n```\r\n\r\n#解释1\r\n```\r\n/*\r\nT 0        1        2        3        4        5 \r\n init    rotate  derive  multiply   rotate   derive\r\n  1        1        1        1        2        2\r\n1   1 -> 1   1 -> 0   2 -> 0   2 -> 1   2 -> 0   3\r\n  1        1        1        2        0        0\r\n  ↑\r\n 箭头指向0位置，逆时针方向0,1,2,3\r\n 最后T = 5时，按照顺时针方向从0开始，小魔法阵能量依次为0 3 2 0\r\n*/\r\n```\r\n\r\n#input2\r\n```\r\n100 12 11 1000000007\r\nmultiply 8 2\r\nderive 11 3\r\nswap 0 4\r\nrotate 0 0\r\nmultiply 9 4\r\nderive 5 10\r\nmultiply 7 2\r\nswap 8 1\r\nmultiply 7 5\r\nrotate 0 0\r\nclear 7 0\r\n```\r\n\r\n#output2\r\n```\r\n12800 2 0 1 0 0 12800 0 129600 0 57600 0\r\n```\r\n"},{"title":"数据范围与提示","type":"limit_and_hint","format":"markdown","require":["katex"],"content":"对于前40%的数据\r\n\r\n1 <= T <= 10^6\r\n\r\n对于全部的数据：\r\n\r\n1 <= T <= 10^15\r\n\r\n2 <= N <= 50\r\n\r\n1 <= M <= 20\r\n\r\nP在signed int范围内 \r\n\r\n"}]}