{"title":"「CTSC2018」假面","time_limit":6000,"memory_limit":512,"tags":["CTSC","2018"],"operation":{"submit":"https://noj.ac/problem/2015#submit_code","submissions":"https://noj.ac/submissions?problem_id=2015","statistics":"https://noj.ac/problem/2015/statistics/fastest","testdata":"https://noj.ac/problem/2015/testdata","discussion":"https://noj.ac/discussion/problem/2015"},"statement":[{"title":"题目描述","type":"description","format":"markdown","require":["katex"],"content":"> 针针是绿绿的好朋友。\r\n\r\n针针喜欢玩一款叫做 DotA (Defense of the Algorithm) 的游戏，在这个游戏中，针针会操纵自己的英雄与队友一起对抗另一支队伍。    \r\n针针在 DotA 中最喜欢使用的英雄叫做假面（Faceless），该英雄有 $2$ 个技能：\r\n - 锁定：对一名指定的敌方单位使用，以 $p$ 的概率对该单位造成 $1$ 点伤害（使其减少 $1$ 点生命值）。     \r\n - 结界：在一片区域施放结界，让该区域内的所有其他单位无法动弹。    \r\n在游戏中，如果一个单位的生命值降至 $0$ 或 $0$ 以下，那么该单位就会死亡。    \r\n针针操纵假面的水平一般，因此他决定勤加练习。现在有 $n$ 个敌方单位（编号从 $1$ 至 $n$），编号为 $i$ 的敌方单位有 $h_i$ 点生命值。    \r\n  \r\n针针已经安排好了练习的计划，他会按顺序施放 $Q$ 个技能：\r\n - 对于锁定技能：针针会指定一个敌方单位 $id$ ，并对它施放。由于决定概率系数 $p$ 的因素很多，因此每次的 $p$ 都不一定相同。\r\n  - 特别地，如果该敌方单位已经死亡，那么该技能不会造成任何效果。\r\n - 对于结界技能：针针会希望对 $k$ 个指定的敌方单位施放，但由于针针并不擅长施放该技能，因此他只能命中**恰好** $1$ 个敌方单位。命中每个**存活**的敌方单位的概率是相等的（也就是说已经死亡的敌方单位不会有任何影响）。\r\n  - 特别地，如果这 $k$ 个敌方单位均已死亡，那么该技能同样不会命中任何敌方单位。\r\n\r\n现在，围观针针进行练习的绿绿想知道：\r\n1. 对于针针施放的每个**结界**技能，它命中各敌人的概率分别是多少。    \r\n2. 在针针的所有技能施放完毕后，所有敌方单位剩余生命值的期望分别是多少。   \r\n\r\n由于绿绿还要围观针针训练，所以请你帮他解决这两个问题。   \r\n为了防止精度误差，对于所有需要输出的数值，请输出其在模 $998244353$ 意义下的值。   \r\n由于结界为假面的终极技能，因此针针施放该技能的次数不会太多。具体请见「子任务」。"},{"title":"输入格式","type":"input_format","format":"markdown","require":["katex"],"content":"第 $1$ 行为 $1$ 个正整数 $n$ ，表示敌方单位的数量。    \r\n第 $2$ 行为 $n$ 个正整数 $m_1, \\dots ,m_n$ ，依次表示各敌方单位的初始生命值。    \r\n第 $3$ 行为 $1$ 个非负整数 $Q$ ，表示针针施放技能的数量。    \r\n第 $4$ 行至第 $Q + 3$ 行，每行描述一个技能，第 $i + 3$ 行描述第 $i$ 个技能。\r\n - 每行的开头为一个整数 $op$ ，表示该技能的种类。  \r\n - 如果 $op = 0$ ，则表示锁定技能。并在此后跟随着 $3$ 个正整数 $id , u , v$ ，表示技能施放的目标为 $id$ ，技能命中的概率为 $p = \\frac{u}{v}$ 。（保证 $1\\le id \\le n , 0 < u \\le v < 998244353$ ）\r\n - 如果 $op = 1$ ，则表示结界技能。并在此后跟随着 $1$ 个正整数 $k$ 表示技能施放的目标数量，随后还有额外的 $k$ 个数 $id_1, \\dots , id_k$ 描述技能施放的所有目\r\n标。（保证所有 $1 \\le id_i \\le n$ 互不相同）\r\n对于每一行，如果行内包含多个数，则用单个空格将它们隔开。"},{"title":"输出格式","type":"output_format","format":"markdown","require":["katex"],"content":"输出包括 $C + 1$ 行（其中 $C$ 为结界技能的数量）：   \r\n - 前 $C$ 行依次对应每个结界技能，对于每行：    \r\n  - 输出 $k$ 个数，第 $i$ 个数表示结界命中敌方单位 $id_i$ 的概率。   \r\n - 第 $C + 1$ 行输出 $n$ 个数，第 $i$ 个数表示在所有技能施放完毕后，敌方单位 $i$ 剩余生命值的期望值。   \r\n\r\n对于每一行，如果行内包含多个数，则用单个空格将它们隔开。    \r\n对于所有数值，请输出它们对 $998244353$ 取模的结果：即设答案化为最简分式后的形式为 $\\frac{a}{b}$ ，其中 $a$ 和 $b$ 的互质。输出整数 $x$ 使得 $bx \\equiv a \\bmod 998244353$ 且 $0 \\le x < 998244353$ 。（可以证明这样的整数 $x$ 是唯一的）"},{"title":"样例","type":"example","format":"markdown","require":["katex"],"content":"#### 样例输入 1\r\n```plain\r\n3\r\n1 2 3\r\n6\r\n0 2 1 1\r\n1 1 2\r\n0 2 1 1\r\n0 3 1 1\r\n1 1 2\r\n1 3 1 2 3\r\n```\r\n\r\n#### 样例输出 1\r\n```plain\r\n1\r\n0\r\n499122177 0 499122177\r\n1 0 2\r\n```\r\n\r\n#### 样例解释 1\r\n针针按顺序施放如下技能：\r\n1. 对敌方单位 $2$ 施放技能锁定：以 $1$ 的概率对其造成 $1$ 点伤害。\r\n  - 此时 $2$ 号敌方单位必定剩余 $1$ 点生命值。\r\n2. 对敌方单位 $2$ 施放技能结界：（由于 $2$ 号敌方单位尚存活，）必定命中 $2$ 号单位。\r\n3. 对敌方单位 $2$ 施放技能锁定：以 $1$ 的概率对其造成 $1$ 点伤害。\r\n4. 对敌方单位 $3$ 施放技能锁定：以1 的概率对其造成 $1$ 点伤害。\r\n  - 此时三个敌方单位的生命值一定分别为 $1, 0 ,2$ ，敌方单位 $2$ 一定死亡。\r\n5. 对敌方单位 $2$ 施放技能结界：（由于 $2$ 号敌方单位已死亡，）必定不命中任何单位。\r\n6. 对敌方单位 $1, 2, 3$ 施放技能结界：命中敌方单位 $1, 3$ 的概率是相等的，即各 $\\frac{1}{2}$ 。\r\n最终，三个敌方单位的剩余生命值一定为 $1 , 0 , 2$ 。\r\n\r\n#### 样例输入 2\r\n```plain\r\n3\r\n1 1 1\r\n4\r\n0 2 1 2\r\n1 2 1 2\r\n0 3 2 3\r\n1 3 1 2 3\r\n```\r\n\r\n#### 样例输出 2\r\n```plain\r\n249561089 748683265\r\n804141285 887328314 305019108\r\n1 499122177 332748118\r\n```\r\n\r\n#### 样例解释 2\r\n对于各结界技能的分析：\r\n1. 第 $1$ 个结界（目标为敌方单位 $1, 2$ ）：\r\n  - $2$ 号敌方单位存活的概率为 $\\frac{1}{2}$ ， $1$ 号敌方单位必定存活。    \r\n  - 如果 $2$ 号敌方单位存活，那么结界命中 $1 , 2$ 的概率相等，均为 $\\frac{1}{2}$ ；如果 $2$ 号敌方单位死亡，那么结界必定命中 $1$ 号敌方单位。\r\n  - 因此：命中 $1$ 号敌方单位的概率为 $ \\frac{1}{2} \\times 1 + \\frac{1}{2} \\times \\frac{1}{2} = \\frac{3}{4}$ ；命中 $2$ 号敌方单位的概率为 $ \\frac{1}{2} \\times 0 + \\frac{1}{2} \\times \\frac{1}{2} = \\frac{1}{4}$ 。\r\n2. 第 $2$ 个结界（目标为敌方单位 $1, 2, 3$ ）：\r\n  - 三个敌方单位存活的概率分别为 $1, \\frac{1}{2} , \\frac{1}{3}$ 。\r\n  - $1 , 2 , 3$ 同时存活的概率为 $\\frac{1}{6}$ ；只有 $1, 2$ 存活的概率为 $\\frac{1}{3}$ ；只有 $1 , 3$ 存活的概率为 $\\frac{1}{6}$ ；只有 $1$ 存活的概率为 $\\frac{1}{3}$ 。\r\n  - 因此：命中 $1$ 号敌方单位的概率为 $\\frac{1}{6} \\times \\frac{1}{3} + (\\frac{1}{3}+\\frac{1}{6}) \\times \\frac{1}{2}+ \\frac{1}{3} \\times 1 = \\frac{23}{36}$ ；命中 $2$ 号敌方单位的概率为 $\\frac{1}{6} \\times \\frac{1}{3} + \\frac{1}{3} \\times \\frac{1}{2} = \\frac{2}{9}$ ；命中 $3$ 号敌方单位的概率为 $\\frac{1}{6} \\times \\frac{1}{3} + \\frac{1}{6} \\times \\frac{1}{2} = \\frac{5}{36}$ 。\r\n最终，三个敌方单位的剩余生命值的期望值为 $1 , \\frac{1}{2} , \\frac{1}{3}$ 。\r\n\r\n#### 样例 3 & 样例 4\r\n见附加文件。"},{"title":"数据范围与提示","type":"limit_and_hint","format":"markdown","require":["katex"],"content":"#### 数据范围\r\n我们记 $C$ 为结界技能的数量。       \r\n\r\n| $n=$  |   $Q=$   |  $C=$  | 测试点编号 | $u,v$ |    其他限制     |      \r\n| :---: | :------: | :----: | :---: | :---: | :---------: |       \r\n|  $5$  |   $21$   |  $6$   |   1   | $u<v$ |      无      |     \r\n| $60$  | $199992$ | $500$  |   2   | $u<v$ | 所有 $p$ 均相等  |    \r\n| $60$  |   $23$   |  $6$   |   3   | $u<v$ | 所有 $m_i =1$ |   \r\n| $60$  | $199994$ | $500$  |   4   | $u<v$ |      无      |   \r\n| $60$  | $199995$ | $500$  |   5   | $u<v$ |      无      |   \r\n| $60$  | $199996$ |  $0$   |   6   | $u<v$ |      无      |   \r\n| $60$  | $199997$ | $500$  |   7   | $u=v$ |      无      |   \r\n| $200$ | $199998$ | $1000$ |   8   | $u<v$ |      无      |    \r\n| $200$ | $199999$ | $1000$ |   9   | $u<v$ |      无      |    \r\n| $200$ | $200000$ | $1000$ |  10   | $u<v$ |      无      |    \r\n\r\n**为了优化你的阅读体验，我们把测试点编号放在了表格的中间，请注意这一点。**\r\n对于所有测试点，保证 $n \\le 200 ,$ $Q \\le 200000 ,$ $C \\le 1000 ,$ $m_i \\le 100$ 。\r\n\r\n#### 提示\r\n1. 第 $3$ 个样例满足测试点 $1$ 的数据规模限制。   \r\n2. <del>第 $4$ 个样例满足限制‘‘所有 $p$ 均相等’’。</del>**事实上这个限制并不满足，这是原题面的错误，在此保留原文。**\r\n3.  $Q$ 的个位可以帮助你快速确定测试点的编号。   \r\n4. 测试点顺序可能与难度无关。   "}]}